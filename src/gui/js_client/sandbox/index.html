
<!doctype html>
<html>
    <head>
	<title>Sandbox - YAACS</title>

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta charset="UTF-8">
        
	<!-- ** external css -->
	<link href="/css-libs/cytoscape-context-menus.css" rel="stylesheet">
	<link href="/css-libs/semantic.min.css" Rel="stylesheet">

	<!-- ** external js -->
        <script src="/js-libs/jquery-3.3.1.min.js"></script>
	<script src="/js-libs/knockout-3.4.2.debug.js"></script>
	<script src="/js-libs/semantic.min.js"></script>
	<script src="/js-libs/cytoscape.min.js"></script>
	<script src="/js-libs/cytoscape-cose-bilkent.js"></script>
	<script src="/js-libs/cola.v3.min.js"></script>
	<script src="/js-libs/cytoscape-cola.js"></script>

	<script src="/js-libs/cytoscape-context-menus.js"></script>
	<script src="/js-libs/cytoscape-automove.js"></script>

	<!-- ** personnal css -->
	<link href="/custom_styles.css" rel="stylesheet">

    </head>

    <!-- * body -->

    <body>



        <div class="ui container"
             data-bind="with:sandboxVM"
             id="sandbox_tab">
	    <!-- left rail -->
	    <div class="ui left rail"
		 style="max-width:100px;padding-right:5px;margin-right:5px">
		<div class="ui fixed top sticky"
		     style="max-width:100px;position:fixed;top:100px" id="left_sim_sticky">
		    <div class="ui segment"
			 style="max-width:100px; margin-left:110px; padding-left:0px; padding-right:0">
			<h4 class="ui horizontal divider header">Simulation</h4>
                        
			<button class="ui primary button tooltip"
				data-bind="click:bactVM.next_reaction"
				style="padding-left:5px;padding-right:5px">
			    Next reaction
			    <span class="tooltiptext">Evaluates the next reaction</span>
			</button>
			<div class="ui action input">
			    <button class="ui primary button tooltip"
				    data-bind="click:bactVM.next_reactions"
				    style="padding-left:5px;padding-right:5px">
				Next reactions
				<span class="tooltiptext">Evaluates the next reaction</span>
			    </button>
			    <input placeholder="number"
				   type="text"
				   size="4"
				   data-bind="value:bactVM.reactions_number_input"/>
			</div>
		    </div>

		</div>
	    </div>


	    <div class="ui divided grid">

                <div class="centered row">
                    <h1 class="ui header" style="margin-top:5px">SandBox</h1>
                </div>


		<div class="row"><h2 class="ui horizontal divider header">
		    Bactery view
		</h2></div>

		<!-- *** première ligne : contrôles généraux-->
		<div class = "row"  id="bactVM" data-bind="with:bactVM">
		    <div class="six wide column">

			<div class="ui horizontal buttons">
			    <button class="ui icon button tooltip" data-bind="click : init_data"><i class="refresh icon"></i>
				<span class="tooltiptext">Use this button after adding a molecule from the MolBuilder</span>
			    </button>
			    <div class="ui button tooltip"
				 data-bind="click:reset_bactery">
				Reset
				<span class="tooltiptext">Reset bactery to initial state</span>
			    </div>
			    <div>
				<label for="bact_load" class="ui button tooltip"
				       id="load_bact_button">
				    Load from file
				    <span class="tooltiptext">Load bactery from a local text file</span>
				</label>
				<input type="file"
				       id="bact_load"
				       style="display:none"/>
			    </div>
			    <div class="ui button" data-bind="click:save_bactery">
				Save to file
			    </div>
			</div>
		    </div>

                    <div class="six wide column">
                        <div class="ui list" data-bind="foreach : Object.keys(env)">
                            <div class="item">
                                <div class="ui label" data-bind="text:$data"> </div>
                                <input type="text" data-bind="textInput : $parent.env[$data]">
                            </div>
                        </div>
                    </div>
                    <div class="two wide column">
                        <div class="ui button tooltip"
			     data-bind="click:commit_env">
			    Commit env.
			    <span class="tooltiptext">Send modified env constants to the sandbox</span>
			</div>
                    </div>
                </div>

		<!-- *** deuxième ligne : molécules inertes-->
		<div class="row"
		     id="bactVM"
		     data-bind="with:bactVM.inertMolsVM">
		    <h3 class="ui horizontal divider header">
			Inert molecules
		    </h3>

		    <div class="nine wide column tooltip"
			 style="max-height:320px;overflow-y:scroll">
			<span class="tooltiptext">Click on a molecule for more </span>
			<h4 class="ui horizontal divider header">
			    Molecules list
			</h4>
			<table class="ui fixed selectable table">
			    <thead ><tr>
				<th class="thirteen wide"> Molecule name</th>
				<th class="three wide"> Quantity</th>
			    </tr></thead>
			    <tbody>
				<!-- ko foreach: mols -->
				<tr data-bind="css:status(), click:$parent.mol_select.bind($data,$index())">
				    <td style="word-wrap:break-word"
					data-bind="text:mol"></td>
				    <td data-bind="text:qtt"></td>
				    <td>
					<div class="ui buttons">
					</div>
				    </td>
				</tr>
				<!-- /ko -->
			    </tbody></table>
		    </div>

		    <div class="five wide column">
			<h4 class="ui horizontal divider header">
			    Selected Molecule
			</h4>
			<div data-bind="text:current_mol_name"></div>
			<button class="ui button tooltip"
				data-bind="click:remove_mol">Remove molecule

			    <span class="tooltiptext">Definitely removes the molecule from the bactery</span>
			</button>

			<div class="ui action input">
			    <button class="ui button tooltip"
				    data-bind="click:set_mol_quantity">
				Set quantity
				<span class="big tooltiptext">Set the quantity of molecules in the bactery. <br> Note that molecules can have negative quantity (ugh), but if the quantity is less than 0 then no transition will be launched in a simulation round </span>
			    </button>

			    <input placeholder="quantity"
				   type="text"
				   size="4"
				   data-bind="value:mol_quantity_input"/>
			</div>

			<button class="ui icon button tooltip"
                                data-bind="click:$parent.send_to_molbuilder.bind($data)">
			    Send to Mol Builder
			    <span class="big tooltiptext">Initiate the Mol Builder with the selected molecule.<br> Use this to see how a particular Petri net is designed</span>
			</button>
		    </div>
                    
                    
		</div>


		<!-- *** troisième ligne : molécules actives-->
		<div class="row"
		     id="bactVM"
		     data-bind="with:bactVM.activeMolsVM">

		    <h3 class="ui horizontal divider header">
			Active molecules
		    </h3>

		    <div class="nine wide column tooltip"
			 style="max-height:320px;overflow-y:scroll">
			                        <span class="tooltiptext">Click on a molecule for more </span>
			                        <h4 class="ui horizontal divider header">
			                        Molecules list
			</h4>
			                        <table class="ui fixed selectable table">
			                        <thead ><tr>
				                        <th class="thirteen wide"> Molecule name</th>
				                        <th class="three wide"> Quantity</th>
			    </tr></thead>
			                        <tbody>
				                        <!-- ko foreach: mols -->
				                        <tr data-bind="css:status(), click:$parent.mol_select.bind($data,$index())">
				                        <td style="word-wrap:break-word"
					data-bind="text:mol"></td>
				                        <td data-bind="text:qtt"></td>
				                        <td>
					                        <div class="ui buttons">
					</div>
				    </td>
				</tr>
				                        <!-- /ko -->
			    </tbody></table>
		                    </div>

		    <div class="five wide column">
			<h4 class="ui horizontal divider header">
			    Selected Molecule
			</h4>

			<div class="ui form">
			                            <div class="field">
				                            <label>Petri Net</label>
				                            <input name="pnet_index" type="hidden">
				                            <select data-bind="options: pnet_indexes,
						   value: selected_pnet_id">
				</select>

			    </div>
			                        </div>

			<div data-bind="text:current_mol_name"></div>
			<button class="ui button tooltip"
				       data-bind="click:remove_mol">Remove molecule

			                            <span class="tooltiptext">Definitely removes the molecule from the bactery</span>
			                        </button>

			<button class="ui icon button tooltip"
                                data-bind="click:$parent.send_to_molbuilder.bind($data)">
			    Send to Mol Builder
			    <span class="big tooltiptext">Initiate the Mol Builder with the selected molecule.<br> Use this to see how a particular Petri net is designed</span>
			</button>
		    </div>

		</div>

		<!-- *** quatrième ligne -->
		<h2 class="ui horizontal divider header">
		    Petri Net manipulation
		</h2>
		<!-- ko if : pnetVM.data() -->
		<div class="row"
		     data-bind="with:pnetVM">

		    <!-- **** 1ere colonne : pnet view -->
		    <div class="twelve wide column">
			<h4 class="ui horizontal divider header">
			    Petri Net view
			</h4>
			<div id="pnet_cy" class="cy big"></div>
		    </div>

		    <!-- **** 2eme colonne : pnet informations -->
		    <div class="four wide column">
			<h4 class="ui horizontal divider header">
			    Petri Net description
			</h4>
			<div id="longribbon" class="ui orange ribbon medium label" style="min-width:0px">
			    Select a place or a transition in the graph to display more  information</div>
			<div class="ui bulleted list">
			    <div class="item" data-bind="text:place_nb"></div>
			    <div class="item" data-bind="text:transition_nb"></div>
			    <div class="item" data-bind="text:launchable_transition_nb"></div>
			</div>

			<!-- **** selon selection -->
			<!-- ***** transition -->
			<div data-bind="with:transitionVM">
			    <div data-bind="if:active">
				<h4 class="ui horizontal divider header">
				    Transition description
				</h4>
				<button
				    class="ui button tooltip"
					   data-bind="click:$parent.launch_transition,
					   css:{primary:launchable()}">
				    Launch transition
				    <span class="big tooltiptext">
					Launches the selected transition.<br>
					<span class="special-text">Be carefull :</span><br>
					Only  yellow (or red if selected) transitions should be launched.
				    </span>
				</button>
			    </div>
			</div>

			<!-- ***** place -->
			<div data-bind="with:placeVM">
			    <div data-bind="if: active">
				<!-- ****** place description-->
				<h4 class="ui horizontal divider header">
				    Place description
				</h4>

				<!-- ******* place extensions display -->
				<h5 class="ui header">Place extensions</h5>
				<div class="ui bulleted list"
				     data-bind="visible:place_extensions().length > 0">
				    <!-- ko foreach: place_extensions -->
				    <div class="item" data-bind="text:$data"></div>
				    <!-- /ko -->
				</div>
				<div data-bind="visible:place_extensions().length == 0">No extensions</div>

				<!-- ******* token display -->
				<h5 class="ui header">Token</h5>
				<div class="ui segment"
				     data-bind="html:token_disp"
				     style="word-wrap:break-word">
				</div>


				<!-- ******* token edit button -->

				<div class="ui divider"></div>
				<div class="ui toggle checkbox">
				    <input type="checkbox" data-bind="checked : token_edit_checkbox">
				    <label>Token edition</label>
				</div>

				<div data-bind="if: token_edit_view" class="tooltip">
				    <span class="big tooltiptext">
					Use this to set a new token in the selected place.<br>
					<span class="special-text">No token</span> will remove any token.<br>
					<span class="special-text">Token</span> will add a token<br>
					Text inputs are used to set the molecule present in the token.

				    </span>
				    <h4 class="ui horizontal divider header">
					Token edition
				    </h4>
				    <div class="ui form">
					<div class="inline fields">
					    <div class="field">
						<div class="ui radio checkbox">
						    <input value="No_token"
							   type="radio"
							   name="token_edit_state_r"
							   data-bind="checked : token_edit_state">
						    <label>No token</label>
						</div>
					    </div>
					    <div class="field">
						<div class="ui radio checkbox">
						    <input
							value="Token"
							type="radio"
							name="token_edit_state_r"
							data-bind="checked : token_edit_state">
						    <label>Token</label>
						</div>
					    </div>
					</div>
					<div data-bind="visible: token_edit_state() == 'Token'">
					    <div class="field">
						<textarea rows=2
							  data-bind="value:token_edit_m1"
							  class="tooltip">
						    <span class="tooltiptext">test</span>

						</textarea>
					    </div>
					    <div class="field">
						<textarea rows=2 data-bind="value:token_edit_m2"></textarea>
					    </div>
					</div>
					<button class="ui primary button" data-bind="click:$parent.commit_token_edit">
					    Commit
					</button>
					<button class="ui button">
					    Discard
					</button>
				    </div>
				</div>
			    </div>
			</div>
		    </div>

		</div>
		<!-- /ko -->
	    </div>
        </div>

    </body>


    <!-- ** scripts loading  -->
    <script src="/js-libs/FileSaver.min.js"> </script>
    <script src="/utils.js"> </script>
    <script src="/pnet_cytoscape.js"> </script>

    <script src="active_molsVM.js"> </script>
    <script src="inert_molsVM.js"> </script>
    <script src="pnetVM.js"> </script>
    <script src="bactVM.js"> </script>
    <script src="sandboxVM.js"> </script>
</html>
